{"version":3,"sources":["webpack://vmap-svg/webpack/universalModuleDefinition","webpack://vmap-svg/webpack/bootstrap","webpack://vmap-svg/./node_modules/formsandlines-utils/lib/svg.js","webpack://vmap-svg/./node_modules/formsandlines-utils/lib/string.js","webpack://vmap-svg/./src/styles.js","webpack://vmap-svg/./src/main.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","getSvgSize","svgText","svg","document","createElementNS","innerHTML","setAttribute","container","querySelector","appendChild","size","getBBox","remove","w","width","h","height","global","common","basic","font","base","textSize","sm","applyStyles","draw","drawPersp","drawList","vmapTree","input","varorder","options","vmapPad","strokeC","vmapC","figPad","figC","hideInputLabel","hideOrderLabel","customLabel","fullInputLabel","inputLabelMax","styleClass","undefined","design","vnum","margins","data","scale","strokeW","bounds","rhomb","Math","sqrt","vmap","elem","constructSVG","subTree","mapSVG","children","position","forEach","child","vColor","Error","figCaption","label","pos","maxLineWidth","leading","style","output","reduce","acc","curr","tagRev","length","labelParts","split","tagSub","processLabel","orderLabel","isFormDNA","includes","prefix","truncMax","truncSuffix","inputLabel","truncated","caption","x","y","appendSize","max","chart","appendix","substr","str","Array","ceil","map","breakStr","lineShift","svgLinebreak","vmapPermutations","globalOptions","margin","vmaps","padding","floor","count","vmapSize","colNum","min","rowNum","tableSize","vmapItems","item","coords","lineSpacing","vmaps_svg","vAlign","getVAlign","val","NaN"],"mappings":"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","file":"vmap-svg.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"vmap-svg\"] = factory();\n\telse\n\t\troot[\"vmap-svg\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/*  --------------------------------------------------------\n    Additions 03/2021\n*/\n\n// export function fitSvg(selector, padding) {\n//     // calculate real dimensions of a chart (assumes chart is a g-element wrapped inside an svg)\n//     d3.select(chart.node().parentElement)\n//         .attr('width', chart.node().getBBox().width + padding.left + padding.right)\n//         .attr('height', chart.node().getBBox().height + padding.top + padding.bottom);\n//   }\n\nexport function getSvgSize(svgText) {\n\tconst svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\tsvg.innerHTML = svgText;\n\tsvg.setAttribute('x','-9999');\n\tsvg.setAttribute('y','-9999');\n\n\tconst container = document.querySelector('body').appendChild(svg);\n\n\tconst size = svg.getBBox();\n\tcontainer.remove();\n\treturn { w: size.width, h: size.height };\n}\n\nexport const svgLinebreak = (str, lineShift) => `<tspan x=\"0\" dy=\"${lineShift}\">${str}</tspan>`;\n\n/*  --------------------------------------------------------\n    Additions 01/2020 from:\n    https://observablehq.com/@formsandlines/js-toolbox\n*/\n\nexport function scaleSVG(svg, container, ratio) {\n    const prefixes = ['-ms-transform','-webkit-transform','-moz-transform','-o-transform','transform'];\n    prefixes.forEach(prefix => {\n        svg.style[prefix] = `scale(${ratio}) translate(0,0)`;\n    });\n    // container.style.width = parseInt(svg.getBBox().width * ratio) + 'px';\n    // container.style.height = parseInt(svg.getBBox().height * ratio) + 'px';\n    container.style.width = svg.getBBox().width * ratio + 'px';\n    container.style.height = svg.getBBox().height * ratio + 'px';\n}\n\n/*  --------------------------------------------------------\n    Additions 10/2020\n*/\n\nexport const processLabel = (label, mode='html') => {\n    /* Label processing to handle sub/superscript */\n\n    let tagRev = []; // tagRev resets y-position of label after subscripts (needed for svg)\n    if (mode === 'svg') tagRev = ['<tspan y=\"0\">','</tspan>'];\n    else tagRev = ['',''];\n\n    if (label.length > 1) {\n        const labelParts = label.split('_');\n\n        let tagSub = [];\n        if (mode === 'svg') tagSub = [`<tspan style=\"font-size: .8em;\" dx=\"0\" dy=\"6\">`,'</tspan>'];\n        else tagSub = ['<sub>','</sub>'];\n\n        return (labelParts.length > 1) ? `${tagRev[0] + labelParts[0] + tagRev[1] + tagSub[0] + labelParts[1] + tagSub[1]}` : tagRev[0]+label+tagRev[1];\n    }\n    else return tagRev[0]+label+tagRev[1];\n};","export function pad(num, size) {\n    /* pads 0s before number string\n       Source: https://stackoverflow.com/a/2998822\n       Credits to: InfinitiesLoop */\n\n    var s = num+\"\"; // converts number to string if not already a string\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\n\n// former String.prototype.replaceAll\nexport function replaceAll(str, find, replace, escapeMeta) {\n    /*  Modified from: https://stackoverflow.com/questions/1144783/how-to-replace-all-occurrences-of-a-string-in-javascript \n    Credits to: Sean Bright */\n    if(escapeMeta) find = escapeRegExp(find);\n    return str.replace(new RegExp(find, 'g'), replace);\n};\n\nexport function escapeRegExp(str) {\n    return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n}\n\n// former String.prototype.addBefore\nexport function addBefore(str, index, replacement) {\n    return str.substr(0, index) + replacement+ str.substr(index);\n}\n\n// former String.prototype.replaceAt\nexport function replaceAt(str, index, replacement) {\n    return str.substr(0, index) + replacement+ str.substr(index + replacement.length);\n}\n\n/*  --------------------------------------------------------\n    Additions 01/2020 from:\n    https://observablehq.com/@formsandlines/js-toolbox\n*/\n\nexport const truncateStr = (str,limit,appendix='') => str.length > limit ? (str.substr(0,limit) + appendix) : str;\n\n\n/* Breaks string up in parts of length n (x <= n for the last part) \n   from: https://observablehq.com/@formsandlines/js-toolbox\n*/\nexport const breakStr = (str,n=1) => [...new Array(Math.ceil(str.length/n))].map((d,i) => str.substr(n*i,n));\n\n","// -----------------------\n// global styles\n\nconst global = {\n    common: {\n        // font: {family: 'sans-serif', size: '14px', style: 'normal'},\n    }\n};\nglobal.basic = {\n    ...global.common,\n};\nconst [basic] = [global.basic];\n\nexport const vmap = {\n    common: {\n        font: {base: `'IBM Plex Mono', 'SFMono-Regular', 'Andale Mono', AndaleMono, 'Lucida Console', 'Lucida Sans Typewriter', Consolas, monospace`},\n        textSize: {base: 12, sm: 10},\n    }\n};\n\nvmap.basic = {\n    ...basic,\n    ...vmap.common,\n};\nvmap.basic.applyStyles = function() {\n\n}","import { processLabel, getSvgSize, breakStr, svgLinebreak } from 'formsandlines-utils';\n\nimport * as styles from './styles.js';\n\nexport default { draw, drawPersp, drawList };\n\n// ===================================================================\n//     formform module 'vmap-svg'\n//     -- since 2020, by Peter Hofmann (formsandlines.eu)\n// ===================================================================\n\nexport function draw (vmapTree, input, varorder, options) {\n\t/* Generates SVG output for a given vmap tree */\n\n\t// option defaults\n\tconst {vmapPad, strokeC, vmapC, figPad, figC, hideInputLabel, hideOrderLabel, customLabel, fullInputLabel, inputLabelMax, styleClass} = {\n\t\tvmapPad: 0, strokeC: `#fff`, vmapC: `none`, figPad: 0, figC: `#fff`,\n\t\thideInputLabel: false, hideOrderLabel: false, fullInputLabel: false, inputLabelMax: 200, \n\t\tcustomLabel: undefined, styleClass: 'basic',\n\t\t...options};\n\n\tconst design = styles.vmap[styleClass];\n\tconst [textSize, font] = [design.textSize, design.font.base];\n\n\tconst {vnum, margins} = vmapTree.data;\n\tconst scale = vmapTree.scale;\n\tconst strokeW = margins[0];\n\t// const len = Math.sqrt(4**vnum); // length of dna without '::'\n\tconst bounds = {w: scale[0] + strokeW, h: scale[1] + strokeW};\n\tconst rhomb = {w: Math.sqrt(2 * (bounds.w**2)), h: Math.sqrt(2 * (bounds.h**2))};\n\n\n\tconst caption = (input, customLabel) => {\n\t\tif (customLabel !== undefined) return customLabel;\n\n\t\tlet label = '';\n\t\tif (!hideOrderLabel && vnum > 0) {\n\t\t\tconst pos = `y=\"0\"`;\n\n\t\t\tlabel += orderLabel(varorder, pos, {font: font, textSize: textSize.base});\n\t\t}\n\t\tif (!hideInputLabel) {\n\t\t\tconst isFormDNA = input.includes('::');\n\n\t\t\tconst prefix = isFormDNA ? '' : `ƒ = `;\n\t\t\tconst truncMax = isFormDNA ? (input.split('::')[0].length + 4**4) : inputLabelMax;\n\t\t\tconst truncSuffix = isFormDNA ? `…(${4**vnum})` : `… <tspan style=\"font-style: italic\">+more</tspan>`;\n\n\t\t\tconst pos = `y=\"0\"` + (label.length > 0 ? ` dy=\"${textSize.base + textSize.sm - 2}px\"` : '');\n\n\t\t\tlabel += inputLabel(input, pos, {prefix: prefix, truncated: !fullInputLabel, truncMax: truncMax, truncSuffix: truncSuffix, font: font, textSize: textSize.sm});\n\t\t}\n\t\treturn label;\n\t}\n\n\tconst vmap = {w: (scale[0] + vmapPad), h: (scale[1] + vmapPad)};\n\n\tvmap.elem = `<svg class=\"vmap\" width=${vmap.w} height=${vmap.h} viewBox=\"-${strokeW/2 + vmapPad/2} -${strokeW/2 + vmapPad/2} ${rhomb.w + vmapPad} ${rhomb.h + vmapPad}\">\n\t\t<rect x=\"-${vmapPad/2}\" y=\"-${vmapPad/2}\" width=\"${rhomb.w + vmapPad}\" height=\"${rhomb.h + vmapPad}\" fill=\"${vmapC}\"></rect>\n\t\t<g transform=\"translate(0,${rhomb.h/2}) rotate(-45,0,0)\" stroke=\"${strokeC}\" stroke-width=\"${strokeW}\">${ constructSVG(vmapTree) }</g>\n\t</svg>`;\n\n\tconst figCaption = {elem: caption(input, customLabel), pos: {x: 0, y: (vmap.h + 10)}};\n\tfigCaption.size = getSvgSize(figCaption.elem);\n\n\tconst appendSize = [Math.max(0, (figCaption.size.w - vmap.w)),\n\t\t\t\t\t\t(figCaption.size.h > 0 ? (figCaption.size.h + (figCaption.pos.y - vmap.h)) : 0)];\n\n\tconst chart = {};\n\n\tchart.size = {w: (vmap.w + appendSize[0] + figPad), h: (vmap.h + appendSize[1] + figPad)};\n\n\tchart.elem = `<svg class=\"vmap-figure\" xmlns=\"http://www.w3.org/2000/svg\" width=\"${chart.size.w}\" height=\"${chart.size.h}\" viewBox=\"-${figPad/2} -${figPad/2} ${chart.size.w} ${chart.size.h}\">\n\t\t<rect x=\"-${figPad/2}\" y=\"-${figPad/2}\" width=\"${chart.size.w}\" height=\"${chart.size.h}\" fill=\"${figC}\"></rect>\n\t\t<g>${ vmap.elem }</g>\n\t\t<g transform=\"translate(${figCaption.pos.x},${figCaption.pos.y})\">${ figCaption.elem }</g>\n\t</svg>`;\n\n\treturn chart;\n}\n\nfunction orderLabel (varorder, pos='x=\"0\" y=\"0\"', options=undefined) {\n\t/* Generates an order label (e.g. \"a > b > c\") from variable order */\n\tconst {maxLineWidth, font, textSize, leading} = \n\t\t{ maxLineWidth: 60, font: 'inherit', textSize: 12, leading: 4, ...options };\n\tconst style = `font-family: ${font}; font-size: ${textSize}px; dominant-baseline: hanging;`;\n\n\tlet output = varorder.reduce((acc,curr,i) => acc + (i > 0 ? '<tspan y=\"0\"> > </tspan>' : '') + processLabel(curr, 'svg'),'' );\n\n\t// output = breakStr(output, maxLineWidth) // <-- fix tag breaks\n\t// \t.reduce((str,curr,i) => str + (i > 0 ? svgLinebreak(curr, (textSize + leading + 'px')) : curr), '');\n\n\treturn `<text ${pos} style=\"${style}\">${output}</text>`;\n}\n\nfunction inputLabel (input, pos='x=\"0\" y=\"0\"', options=undefined) {\n\t/* Generates an input label (e.g. \"ƒ = ((a)b)\" or \"::3210\") */\n\tconst {prefix, maxLineWidth, truncated, truncMax, truncSuffix, font, textSize, leading} = \n\t\t{prefix: '', maxLineWidth: 60, truncated: false, truncMax: 1000, truncSuffix: '…', font: 'inherit', textSize: 12, leading: 4, ...options };\n\tconst style = `font-family: ${font}; font-size: ${textSize}px; dominant-baseline: hanging;`;\n\n\tlet output = prefix + input;\n\tlet appendix = '';\n\n\tif (truncated && (output.length > truncMax)) {\n\t\toutput = output.substr(0,truncMax);\n\t\tappendix += truncSuffix;\n\t}\n\toutput = breakStr(output, maxLineWidth)\n\t\t.reduce((str,curr,i) => str + (i > 0 ? svgLinebreak(curr, (textSize + leading + 'px')) : curr), '');\n\n\treturn `<text ${pos} style=\"${style}\">${output + appendix}</text>`;\n}\n\nfunction constructSVG(subTree, mapSVG='') {\n\t/* Recursive function to construct svg markup from vmap tree structure */\n\n\tif(subTree !== null && typeof subTree == \"object\") {\n\t\tif(subTree.children) {\n\t\t\tmapSVG += `<g transform=\"translate(${subTree.position[0]}, ${subTree.position[1]})\">`;\n\n\t\t\tsubTree.children.forEach(child => {\n\t\t\t\tmapSVG += constructSVG(child);\n\t\t\t});\n\t\t\tmapSVG += `</g>`;\n\t\t\treturn mapSVG;\n\t\t}\n\t\telse {\t\t\t\t\n\t\t\tmapSVG += `<rect x=\"${subTree.position[0]}\" y=\"${subTree.position[1]}\" width=\"${subTree.scale[0]}\" height=\"${subTree.scale[1]}\" fill=\"${vColor(subTree.value)}\"></rect>`;\n\t\t\treturn mapSVG;\n\t\t}\n\t}\n\telse {\n\t\tthrow new Error('Not a subtree!');\n\t};\n}\n\n\nexport function drawPersp (vmapPermutations, input, globalOptions=undefined) {\n\t/* Constructs vmap perspectives as HTML output (flex list) */\n\n\tconst {figPad, figC, margin, customLabel, styleClass} = \n\t\t{ figPad: 0, figC: `#fff`,\n\t\t  margin: 20, customLabel: undefined, styleClass: 'basic', ...globalOptions };\n\n\tconst design = styles.vmap[styleClass];\n\tconst [textSize, font] = [design.textSize, design.font.base];\n\n\tconst chart = {vmaps: vmapPermutations, input: input, options: globalOptions};\n\n\n\tconst padding = {x: (Math.floor(margin/4)), y: (Math.floor(margin/2))};\n\tconst count = vmapPermutations.length;\n\tconst vmapSize = vmapPermutations[0].size;\n\n\tconst colNum = Math.min(count, 6);\n\tconst rowNum = Math.floor(count/colNum);\n\tconst tableSize = { w: vmapSize.w * colNum + (padding.x*2) * (colNum-1),\n\t\t\t\t\t\th: vmapSize.h * rowNum + (padding.y*2) * (rowNum-1) };\n\n\tconst vmapItems = vmapPermutations.map(vmap => {\n\t\t\n\t\treturn {elem: vmap.elem};\n\t}).reduce((str,item,i) => {\n\t\tconst x = i%colNum;\n\t\tconst y = Math.floor(i/colNum);\n\n\t\tconst coords = [vmapSize.w * x + (padding.x*2) * x,\n\t\t\t\t\t\tvmapSize.h * y + (padding.y*2) * y];\n\t\treturn str+ `<g class=\"vmap-item\" transform=\"translate(${coords[0]},${coords[1]})\">${item.elem}</g>`;\n\t},'');\n\n\tconst caption = (input, customLabel) => {\n\t\tif (customLabel !== undefined) return customLabel;\n\n\t\tconst isFormDNA = input.includes('::');\n\t\tconst prefix = isFormDNA ? '' : `ƒ = `;\n\t\tconst pos = `y=\"0\"`; //  dy=\"${textSize.base + textSize.sm - 2}px\"\n\n\t\treturn inputLabel(input, pos, {prefix: prefix, truncated: false, font: font, textSize: textSize.base});\n\t}\n\n\tconst figCaption = {elem: caption(input, customLabel), pos: {x: 0, y: tableSize.h + padding.y}, lineSpacing: padding.y};\n\tfigCaption.size = getSvgSize(figCaption.elem);\n\n\tconst appendSize = [Math.max(0, (figCaption.size.w - tableSize.w)),\n\t\t\t\t\t\tfigCaption.size.h + (figCaption.pos.y - tableSize.h) + figCaption.lineSpacing];\n\n\t// const listMargin = {x: 0, y: Math.floor(margin/2)};\n\n\tchart.size = {w: (tableSize.w + appendSize[0] + figPad), \n\t\t\t\t\th: (tableSize.h + appendSize[1] + figPad)};\n\n\tchart.elem = `<svg class=\"vmap-perspectives-figure\" xmlns=\"http://www.w3.org/2000/svg\" width=\"${chart.size.w}\" height=\"${chart.size.h}\" viewBox=\"-${figPad/2} -${figPad/2} ${chart.size.w} ${chart.size.h}\">\n\t\t<rect x=\"-${figPad/2}\" y=\"-${figPad/2}\" width=\"${chart.size.w}\" height=\"${chart.size.h}\" fill=\"${figC}\"></rect>\n\t\t<g class=\"vmap-perspectives vmap-table\">${ vmapItems }</g>\n\t\t<g transform=\"translate(${figCaption.pos.x},${figCaption.pos.y})\">\n\t\t\t<line x1=\"0\" y1=\"0\" x2=\"${tableSize.w}\" y2=\"0\" stroke=\"black\" stroke-width=\"0.5\" />\n\t\t\t<g transform=\"translate(0,${figCaption.lineSpacing})\">${ figCaption.elem }</g>\n\t\t</g>\n\t</svg>`;\n\n\treturn chart;\n}\n\n\nexport function drawList (vmaps_svg, globalOptions=undefined) {\n\t/* Constructs multiple vmaps as SVG output */\n\n\tconst {margin, vAlign} = { margin: 20, vAlign: 'bottom', ...globalOptions }\n\n\t// const vmapItems = vmapPermutations_svg.map(draw => {\n\t\t\t\n\t// \treturn {size: draw.size, elem: draw.elem};\n\t// }).reduce((str,item,i,arr) => {\n\n\t// \t// const shiftX = (i > 0) ? ( arr[0].size.w * i + (padding.x*2) * i ) : 0;\n\t// \treturn str+ `<g class=\"vmap-item\" transform=\"translate(${shiftX},0)\">${item.elem}</g>`;\n\t// },'');\n\n\treturn `<div class=\"vmap-list\" style=\"display: flex; flex-wrap: wrap; ${getVAlign(vAlign)} margin: 0 -${Math.floor(margin/2)}px\">\n\t\t\t${ vmaps_svg.reduce((str, draw) => `${str}<div class=\"vmap-item\" style=\"padding: ${Math.floor(margin/4)}px ${Math.floor(margin/2)}px\">${draw.elem}</div>`,'') }\n\t\t\t</div>`\n};\n\n// -----------------------------------------------------------\n//                         Helper\n// -----------------------------------------------------------\n\nconst getVAlign = vAlign => {\n\t// >>> as helper\n\tconst alignItems = vAlign === 'top'    ? 'flex-start'\n\t\t\t\t \t : vAlign === 'center' ? 'center'\n\t\t\t\t \t : vAlign === 'bottom' ? 'flex-end' : 'flex-end';\n\treturn `align-items: ${alignItems};`;\n}\n\nconst vColor = val => {\n\t/* Value to color map for vmap */\n\treturn val == 0 ? '#000000'\n\t\t : val == 1 ? '#4757ff'\n\t\t : val == 2 ? '#ff0044'\n\t\t : val == 3 ? '#00ff5f'\n\t\t : NaN;\n};"],"sourceRoot":""}